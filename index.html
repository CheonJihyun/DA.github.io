<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Markdown Collapse Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.8.1/github-markdown-dark.min.css"
    />
    <style>
      body {
        background: #1e1e1e;
        color: #ddd;
      }

      .markdown-body {
        max-width: 800px;
        margin: auto;
        padding: 20px;
      }
      .collapsible {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
      }
      .collapsible button {
        background: none;
        border: none;
        font-size: inherit; /* 제목 크기 유지 */
        cursor: pointer;
      }
      .collapsible-content {
        display: block; /* 기본적으로 펼쳐진 상태 */
      }

      h2 {
        margin-left: 0px;
      }
      h3 {
        margin-left: 20px;
      }
      h4 {
        margin-left: 40px;
      }

      /* h1, h2, h3, h4 제외한 모든 요소에 indent 추가 */
      .markdown-body :not(h1):not(h2):not(h3):not(h4) {
        margin-left: 20px;
      }
    </style>
  </head>
  <body>
    <div class="markdown-body">
      <div id="md-content">Loading markdown...</div>
    </div>

    <script>
      fetch("./SQLD/SQLD 오답노트_Part2-2_천지현_250205.md")
        .then((response) => response.text())
        .then((text) => {
          let htmlContent = marked.parse(text);
          document.getElementById("md-content").innerHTML = htmlContent;

          setTimeout(() => {
            let currentHeading = null;

            // h2, h3, h4 순차적으로 접기 기능 적용
            document.querySelectorAll("h2, h3, h4").forEach((heading) => {
              const wrapper = document.createElement(heading.tagName);
              wrapper.classList.add("collapsible");

              const button = document.createElement("button");
              button.innerText = "➖"; // 기본적으로 펼쳐진 상태
              button.onclick = function () {
                const content = this.parentElement.nextElementSibling;
                if (content.style.display === "none") {
                  content.style.display = "block";
                  this.innerText = "➖";
                } else {
                  content.style.display = "none";
                  this.innerText = "➕";
                }
              };

              const headingText = document.createElement("span");
              headingText.innerHTML = heading.innerHTML;

              wrapper.appendChild(button);
              wrapper.appendChild(headingText);
              heading.replaceWith(wrapper);

              const content = document.createElement("div");
              content.classList.add("collapsible-content");

              let nextElement = wrapper.nextElementSibling;
              while (
                nextElement &&
                !["H2", "H3", "H4"].includes(nextElement.tagName)
              ) {
                const temp = nextElement.nextElementSibling;
                content.appendChild(nextElement);
                nextElement = temp;
              }

              wrapper.after(content);

              // 각 제목에 맞는 margin-left 적용
              if (heading.tagName === "H3") wrapper.style.marginLeft = "20px";
              if (heading.tagName === "H4") wrapper.style.marginLeft = "40px";
            });
          }, 100);
        })
        .catch((error) => console.error("Markdown file not found", error));
    </script>
  </body>
</html>
